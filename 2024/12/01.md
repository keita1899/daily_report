# 12/01

## 取り組んだこと

- AWS コンテナ設計・構築本格入門
  - 1
  - 2
  - 3

## 学んだこと

### AWS コンテナ設計・構築本格入門

#### 1 章 コンテナの概要

- コンテナは他のプロセスとは隔離された状態で OS 上にソフトウェアを実行する技術
- コンテナは単なる 1 つのプロセスで稼働しているにもかかわらず、独立した OS 環境のように見える
- サーバー仮想化ではゲスト OS ごとにカーネルを占有するが、コンテナでは OS とカーネルは共有し、プロセスを分離する
- コンテナによって環境の依存をコンテナ内で完結できる
- コンテナは他の環境でも動かしやすい
- サーバー仮想化ではゲスト OS 自体のリソースが必要だが、コンテナではゲスト OS やハードウェアのエミュレートが不要になるのでリソースの消費が少なくなる
- Docker のタグはイメージのバージョン管理を行うためにつける
- 多数のコンテナを稼働させるには、単一のホストではなく、複数ホストから構成されたクラスター構成を扱う
- オーケストレータとはプロダクション環境でコンテナ群を管理するためのサービス
- オーケストレータによってコンテナの配置管理や負荷分散、監視やデプロイができる
- オーケストレータの種類はデファクトスタンダードの Kubernetes、Kubernetes をベースとした AmazonEKS などがある
- AmazonECS は AWS が提供する独自のコンテナオーケストレータで、AWS サービスとの親和性が高い
- コンテナの設計は従来のオンプレミスとは異なる考え方
- パブリッククラウドを前提としても従来のサーバー構築で求められる非機能観点は重要
- コンテナはアプリと依存関係を 1 つのパッケージとして扱う

#### 2 章 AWS が提供するコンテナサービス

- コントロールプレーンとはオーケストレータのコンテナを管理する機能
- AWS が提供するコントロールプレーンは ECS と EKS がある
- オーケストレーションサービスとはコンテナを管理するサービスであり、コンテナを動かす実行環境のサービスではない
- ECS 上でアプリを起動するにはコンテナが必要であり、ECS でのコンテナが動作するコンポーネントをタスクという
- タスク定義とは JSON で記述するタスクを作成するテンプレート定義のこと
- タスク定義には複数のコンテナの定義を設定できる
- サービスは指定した数だけタスクを維持するスケジューラーで、オーケストレータの中心的な役割を担う
- データプレーンとはコンテナが稼働するリソース環境
- データプレーンには EC2 と Fargate がある
- EC2 は AWS で仮想マシンを利用できるサービスで、必要に応じてスペックを変更できる
- EC2 を使うと、サーバーの監視等が必要になるが、ユーザーの要件に合わせて設定が可能
- Fargate は ECS や EKS のコンテナ向けのサーバーレスコンピューティングエンジンで、EC2 とは異なり単体では使えない
- Fargate を使うと、ホストの管理が不要になり、運用上のオーバーヘッドが発生しないが、価格面で基本的に EC2 より高い
- ビジネス面から考えると、差別化しにくい OS の運用から解放されるため、EC2 より Fargate の方が有利
- ECR はコンテナイメージを保存するリポジトリ
- AWS Lambda は内部的にコンテナを利用していて、ユーザーがコードをアップロードするだけでコードを実行でき、コンピューティングリソースを自動的に構築してくれるサービス
- Lambda は Fargate とは異なり、コンテナを意識せずに開発者がコードに集中できる
- AWS App Runner はスケール可能な Web アプリをデプロイするマネージドサービスで、Github と連携してビルドとデプロイをしたり、ECR のコンテナイメージも即座にデプロイできる

##### コンテナアーキテクチャの 4 つのパターン

考慮すべき点

- コスト（）
- 拡張性（デプロイの速さ、水平スケーリング、垂直スケーリング）
- 信頼性（動作が一貫していること、復旧のしやすさ）
- エンジニア人材の確保のしやすさ

- ECS on EC2
  - EC2 上に ECS のタスクを起動してタスク上でコンテナを稼働させる
  - サービス利用時のコストはインスタンスの大きさと稼働時間による、運用コスト高い、学習コスト低い、デプロイ速い、障害復旧は AWS 側、障害調査はしやすい、経験者が多い
- ECS on Fargate
  - Fargate 上に ECS のタスクを起動してタスク上でコンテナを稼働させる
  - EC2 より割高、運用コスト低い、学習コストは比較的低い、デプロイは比較的遅い、障害復旧は AWS 側、障害調査は難しい、経験者は増えてきている
- EKS on EC2
  - コントロールプレーンが EKS、データプレーンが EC2
  - EC2 上に EKS のノードを起動してノード上でコンテナを稼働させる
  - 運用コスト高い、学習コスト高い、デプロイ速い、障害復旧は AWS 側（Kubernetes はユーザー側）、障害調査はしやすい、Kubernetes の経験者は多い
- EKS on Fargate
  - コントロールプレーンが EKS、データプレーンが Fargate
  - 運用コスト低い、学習コスト最も高い、デプロイ遅い、障害復旧はユーザー側、障害調査は難しい、経験者が少ない

##### 各アーキテクチャに適応したユースケース

- オンプレミスやEC2上でKubernetesを動かしているケース
  - EKS on EC2

#### 3 章 コンテナを利用した AWS アーキテクチャ

## わからなかったこと

- ハードウェアのエミュレートが不要になるとはどういうことか

## 次やること

-

## 感想
