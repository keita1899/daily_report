# 日報

## 取り組んだこと

- Amazon Web Services 基礎からのネットワーク＆サーバー構築
  - 5
  - 6
  - 7
  - 8
  - 9

## 新しく学んだこと

### Amazon Web Services 基礎からのネットワーク＆サーバー構築

#### 5 章 HTTP の動きを確認する

- HTTP はハイパーテキストを伝送するための通信規約
- Telnet クライアントを使うことで、HTTP プロトコルで通信できる
- Telnet はリモートコンピュータと通信するための仕組みで、SSH と異なり、暗号化されていない
- Telnet の接続先は普通は Telnet サーバーだが、ポート 80 万に接続すればサーバーから HTTP のレスポンスを得ることができる
- macOS では HighSierra から telnet が標準でインストールされなくなった
- まとめ
  - HTTP プロトコルの概要
  - Firefox の開発者ツールを使ってブラウザとサーバーの通信を確認

#### 6 章 プライベートサブネットを構築する

- インターネットから隔離したプライベートサブネットを配置することでセキュリティを高める
- サブネットは別々のアベイラビリティゾーンにあっても通信できるが、距離による遅延が発生することはある
- プライベートサブネットとサーバー構築手順
  1. サブネットの作成
  2. サブネット名を入力
  3. アベイラビリティソーンを選択
  4. CIDR ブロックを入力
  5. 作成ボタンをクリック
  6. インスタンスの作成
  7. VPC 領域とサブネットの選択
  8. 自動割り当てパブリック IP を無効化、またはサブネット設定を無効にする
  9. ネットワークインタフェースの部分でプライベート IP アドレスを s ってい
  10. サーバー名をつける
  11. 新規にセキュリティグループを設定する
  12. DB サーバーの通信ポートを通す設定を行う
  13. インスタンスを起動する
- プライベートサブネットはインターネットに接続しないのでデフォルトのルートテーブルのまま変更する必要はない
- サーバー間での疎通を確認するには`ping`コマンドを使う
- `ping`を使うと ICMP というプロトコルを使い、ICMP エコー要求と ICMP エコー応答のやりとりから疎通を確認できる
- `ping`で疎通を確認するにはセキュリティグループで ICMP プロトコルを許可する必要がある
- DB サーバーはインターネットと繋がっていないので以下の手順で踏み台サーバーを使って接続する
  1. Web サーバーに SSH で接続
  2. Web サーバーから DB サーバーに SSH で接続
- Web サーバーから DB サーバーに SSH で接続する場合、秘密鍵を Web サーバーに置いておく必要がある
- サーバーにファイルを転送するには SCP（Secure Copy）というプロトコルを使う
- Web サーバーにログインしたら秘密鍵の権限を自分しか読めないように変更する必要がある
- プライベートサブネットに置かれたサーバーにアクセスする場合は踏み台サーバーを使ってログインするのが一般的
- まとめ
  - プライベートサブネットの扱い
  - プライベートサブネットはローカルからアクセスできないので、通信可能な何らかのサーバーを踏み台にして SSH でログインする
  - プライベートサブネット内からインターネットにアクセスはできないので、次の章の NAT で解決する

#### 7 章 NAT を構築する

- NAT はプライベートサブネットからインターネットの向きの通信だけを許可する
- NAT は IP アドレスを変換する装置で、2 つのネットワークインタフェースを持つ
- 片側のインタフェースにはパブリック IP アドレスを設定しインターネットに接続可能な構成にして、もう片側にはプライベート IP アドレスを設定し、プライベートサブネットに接続する
- プライベートサブネットの D サーバーからインターネットにパケットを送信しようとすると、NAT がパケットの送信元 IP アドレスを自身のパブリック IP アドレスに変換することで、プライベートサブネットからインターネットに接続できる
- 家庭でインターネットに接続するときはルーターが使われることがほとんどで、ルーターの内部では NAT 機能が動作している
- NAT によって、プロバイダから割り当てられるパブリック IP アドレス 1 つだけで、複数台のホストがインターネットに接続できる
- AWS では NAT の機能は NAT ゲートウェイによって行う
- AWS で NAT を構築する方法は 2 つある
- NAT ソフトウェアがインストールされた AMI から EC2 を起動して使う方法
  1. インスタンスを作成する時にコミュニティ AMI で`ami-vpc-nat`を選択してインストールする
- NAT ゲートウェイを使う方法
  1. NAT ゲートウェイを作成する
  2. NAT ゲートウェイをパブリックサブネットに配置する
  3. NAT ゲートウェイに ElasticIP アドレスを割り当てる
  4. プライベートサブネットからインターネット宛のパケットが NAT ゲートウェイを経由するようにルートテーブルを変更する
- NAT ゲートウェイは負荷に応じてスケールアップし、利用しないときは停止ではなく破棄する必要がある
- `curl`コマンドは HTTP や FTP でファイルをダウンロードしたりアップロードしたりするコマンド
- まとめ
  - NAT ゲートウェイを使ってプライベートサブネットからインターネットに接続する

#### 8 章 DB を用いたブログシステムの構築

- Web サーバーに Wordpress をインストールし、DB サーバーに MariaDB をインストールする
- MariaDB を使用する手順
  1. 踏み台サーバーを使って DB サーバーにログインする
  2. `yum`コマンドで MariaDB をインストールする
  3. MariaDB を起動する
  4. 管理者パスワードを設定する
  5. MariaDB に接続する
  6. ユーザーを作成する
  7. WordPress で使用するデータベースを作成する
  8. DB サーバーを起動した時に MariaDB を自動で起動する設定をする
- WordPress を使う手順
  1. WordPress を使うために必要な PHP と関連ライブラリをインストールする
  2. Web サーバーから DB サーバーの MariaDB への疎通を確認する
  3. 提供元のサイトから WordPress のソースファイルをダウンロードする
  4. WordPress のソースファイルを Apache の`/var/www/html/`にコピーする
  5. Apache を起動する
  6. WordPress の初期設定を行う
  7. データベースを設定する
  8. サイトのタイトルや管理者情報を入力する
- まとめ
  - WordPress と MariaDB を用いたブログシステムの構築
  - インターネットに接続されているのは Web サーバーだけ

#### 9 章 TCP/IP による通信の仕組みを理解する

- DNS の名前解決や HTTP の通信は TCP/IP の上に成り立っている
- TCP/IP は役割ごとに 4 つの階層に分けたモデルで、各層にプロトコルがある
- 4 つの階層
  - アプリケーション層 - ソフトウェア同士が通信する
  - トランスポート層 - TCP や UDP など、データの転送を制御する
  - インターネット層 - IP アドレスの割り当て、ルーティング
  - インターフェース層 - ネットワークに接続されている機器同士で通信する
- 7 階層からなる OSI 参照モデルを TCP/IP に向けにアレンジしたのが TCP/IP モデル
- 階層化することで各階層を独立させる
- 現在のインターネットの接続には Ethernet（LAN）を使うのが主流
- TCP/IP モデルから見た DNS の名前解決の流れ
  1. ブラウザで URL を入力する
  2. URL からドメインを抜き出す
  3. DNS サーバーに対して名前解決のリクエストデータを作成する
  4. トランスポート層で UDP を使ってリクエストデータがカプセル化され、ポート番号などの処理に必要なデータ（UDP ヘッダー）が付与される
  5. さらにデータがインターネット層に渡されて、IP を使ってカプセル化され、IP アドレスなどのデータ（IP ヘッダー）が追加される
  6. さらにインターフェース層に渡されて、Ethernet でカプセル化され、送信元 MAC アドレスや宛先 MAC アドレスが含まれる Ethernet フレームが追加される
- DNS では UDP を使う
- Ethernet は LAN の規格
- Ethernet で通信する機器には工場出荷時に唯一無二の MAC アドレスが振られている
- MAC アドレスと IP アドレスの対応を解決するのが ARP（Address Resolution Protocol）というプロトコル
- ARP の範囲はルーターまで
- UDP は状態を持たないステートレスなプロトコルで、やり取りが単純な分、高速に送信できる
- TCP は双方向の通信が可能な信頼性の高いプロトコル
- TCP は通信相手と 3 ウェイハンドシェークで疎通を確認する
- TCP で送受信するデータにはデータの順序であるシーケンス番号という連番が振られ、送信側は ACK と応答番号を確認することで相手に届いたかどうかを確認する
- TCP には通信状態を示すフラグがあり、重要なのが受領の合図である ACK
- まとめ
  - TCP/IP においてパケットが送受信される仕組み
  - UDP と TCP の違い

## わからなかったこと

- ARP の範囲

## 次やること

-

## 感想
