# 11/22

## 取り組んだこと

- ネットワークはなぜつながるのか

## 学んだこと

### ネットワークはなぜつながるのか

- URL をブラウザに入力してから画面に Web のページが表示されるまでの流れをまとめたもの
- ブラウザに要求してサーバーが要求に従って結果を返す
- 通信相手を正確に識別して、リクエストやレスポンスを相手側まで運ぶ仕組みが必要
- リクエストやレスポンスはみな 0 と 1 から成るデジタルデータなので、ネットワークはデジタルデータを目的地まで運ぶ仕組み
- ネットワークは OS に組み込まれたネットワーク制御用ソフトウェアや、スイッチ、ルーターといった機器が役割分担しながら実現する
- デジタルデータは小さく分割したパケットで運ぶ
- デジタルデータを運ぶ仕組みと、ブラウザや Web サーバーといったアプリでネットワークは成り立つ

#### 流れまとめ

1. URL をブラウザに入力すると、ブラウザは決められたルールに従って URL の意味を調べ、その意味に従ってリクエストメッセージを作る
2. リクエストメッセージは OS に組み込まれたネットワーク制御用ソフトウェア（プロトコルスタック）に依頼してサーバーに届けてもらう
3. プロトコル・スタックはブラウザから受け取ったメッセージをパケットに格納して宛先アドレスなどの情報を付加する
4. 次にパケットを LAN アダプタに渡し、LAN アダプタが電気信号に変換して LAN のケーブルに送り出すことで、パケットがネットワークの中に入る
5. LAN アダプタが送信したパケットはスイッチング・ハブなどを経由してインターネット接続用ルーターに届く
6. ルーターの先はインターネットであり、プロバイダがパケットを相手まで運ぶ
7. インターネットの入り口にはアクセス回線があり、アクセス回線は契約しているプロバイダにつながっていて、そこに POP というプロバイダ向けに作られたルーターがある
8. POP の先がインターネットの中核部分につながる
9. Web サーバー側の LAN にたどり着くとファイアウォールが待ち構えていて、パケットをチェックする
10. チェックが終わればキャッシュサーバーや負荷分散装置を通る
11. パケットが Web サーバー・マシンにたどり着いたら、パケットの中身から元のリクエストメッセージを復元し、Web サーバー・アプリに渡す
12. Web サーバー・アプリがリクエストからレスポンスを作り、ここまでの流れと逆の動きでクライアントに送信する
13. クライアントにレスポンスが届いたら、そこからページのデータを取り出して画面に表示する

#### 1 章 Web ブラウザがメッセージを作る

1. ブラウザが URL を解読する
2. → Web サーバーへのリクエストを作る
3. → OS に依頼して Web サーバーにリクエストを送信してもらう
4. → Web サーバーの IP アドレスが必要
5. → Web サーバーのドメイン名から DNS サーバーに問い合わせて IP アドレスを調べる
6. → OS に依頼する

- ブラウザはいくつかの機能があるため、`http:`なら Web サーバー、`ftp:`なら FTP サーバーといったプロトコルが用意されている
- URL を解読するときは分解する
- URL のファイル名を省略したときはどのファイルにアクセスすればいいかわからないため、あらかじめファイル名をサーバー側に設定しておく
- リクエストでは何をどうして欲しいのかが書かれており、何をが URI、どうしてがメソッドにあたる
- メソッドは Web サーバーにどのような動作をして欲しいのか伝える
- Web サーバーにデータを送る場合は、ヘッダーフィールドに入る
- POST メソッドの場合は URI はプログラムのファイル名を書く
- メソッドは URL 欄の入力や、フォームの入力、リンクなどブラウザの動作状態で判断する
- リクエストメッセージに書く URI は 1 つだけと決まっているので、ファイルは 1 度に 1 つしか読み出せない
- 複数のファイルを読み出すときは別々にリクエストメッセージをサーバーに送る
- ブラウザは HTTP メッセージをネットワークに送り出す機能はないので、OS に依頼する
- OS に依頼する時にドメイン名ではなく、IP アドレスで指定する必要があるので、ドメインから IP アドレスを調べる
- TCP/IP ではサブネットという小さなネットワークをルーターで接続して全体のネットワークを作っている
- 送信元がメッセージを送ったら、サブネットの中のハブが送信元から一番近いルーターまで届けて、ルーターが次の送信先のルーターを判断して送信の指示を行うと、サブネット内のハブがそのルーターまでメッセージを届ける、これを繰り返すことで相手にデータが届く
- IP アドレスはネットワーク部とホスト部の内訳が決まっていないので、自分で決めることができる
- ホスト部がすべて 0 の場合サブネット自体を指す
- ホスト部がすべて 1 の場合サブネット内にある機器全員にパケットを送信するブロードキャストを表す
- IP アドレスは 4 バイトしかないのに対し、ドメイン名は少なくても数十バイト、最大で 255 バイトもあるので、ルーターにサーバー名を使うと効率が悪い
- IP アドレスを調べるには最寄りの DNS サーバーに問い合わせる
- DNS クライアントは DNS リゾルバといい、実体は Socket ライブラリに入っている部品化したプログラム
- Socket ライブラリは OS に組み込まれているネットワーク機能をアプリから呼び出すための部品を集めたもの
- IP アドレスを調べる時はリゾルバを呼び出せば、リゾルバが DNS サーバーに問い合わせて、DNS サーバーから IP アドレスが格納された応答メッセージが返ってくる
- DNS サーバーから返された IP アドレスはリゾルバがブラウザから指定されたメモリ領域の中に書き込む
- ブラウザが Web サーバーにメッセージを送る時はメモリから IP アドレスを取り出して、HTTP リクエストと一緒に OS に渡して送信を依頼するだけ
- リゾルバもブラウザ同様、ネットワークに対してデータを送受信する機能を持っていないので、プロトコルスタックを呼び出して依頼する
- 層を成すように多数のプログラムが役割分担して存在していて、上位の層から下位の層に実行を依頼しながら処理を進めていく
- DNS サーバーの IP アドレスも必要になるが、TCP/IP の設定項目としてあらかじめコンピュータに設定されてある
- 問い合わせメッセージにはサーバーの名前、クラス（現在はインターネットを表す IN という値）、タイプ（名前にどんな種類の情報が対応づけられているかを表す）の 3 つの情報が含まれる
- www は Web の仕組みが作られたころに Web サーバーの名前として登録されることが多かったので慣例になっているだけ
- 名前とタイプによって調べる情報を指定し、それに従って該当するものを探してクライアントに返答するのが DNS サーバーの基本動作
- インターネットには莫大な数のサーバーがあるので、情報を分散させて、多数の DNS サーバーが連携して登録されている情報を探し出す仕組みになっている

#### 2 章 TCP/IP のデータを電気信号にして送る

#### 3 章 ケーブルの先は LAN 機器だった

#### 4 章 アクセス回線を通ってインターネットの内部へ

#### 5 章 サーバー側の LAN には何がある

#### 6 章 Web サーバーに到着し、応答データが Web ブラウザに戻る

## わからなかったこと

-

## 次やること

-

## 感想
