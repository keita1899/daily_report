# 8/3

## 取り組んだこと
- Zenn 猫でもわかるHotwire入門 Turbo編
  - 1
  - 2
  - 3
  - 4
  - 5
  - 6
  - 7
  - 8
  - 9
  - 10
  - 11
  - 12
- udemy React完全入門ガイド
  - 1
  - 2
  - 3

## 学んだこと
### Rails
- `<%= render @cats %>`で`_cat.html.erb`を読み込むとインスタンスの数だけ読み込まれる（ループされるのと同じ）

### 猫でもわかるHotwire入門 Turbo編
- 2 Hotwireとは
  - Rails7でモダンなWebアプリを作るためのアプローチであるHotwireがデフォルトになった
  - HotwireはTurbo、Stimulus、Stradaの3つの技術で構成されるもので、Railsにに依存していない
  - TurboはJavaScriptを書かずにSPAを作れるJavaScriptのライブラリで、Turbo Drive、Turbo Frames、Turbo Streams、Turbo Nativeの4つの技術で構成される
  - StimulusはTurboと相性が良いJavaScriptのライブラリで、JavaScriptにレールを敷く役割を担っている
  - StradaとTurbo Nativeはモバイルアプリ開発に使う
を記述する  - ReactやVueなどを使ったSPAではJSONを返すのに対し、HotwireはHTMLを返すので、Railsだけで完結し、ビューを構築するgemなどもそのまま使える
  - Hotwireはリクエストは全てFetch APIを使った非同期リクエストになり、サーバーからのレスポンスでHTMLを返す
  - Turbo Driveは画面遷移を高速にする機能で、Turbolinksの名前を変えたもの
  - Turbo Driveは画面遷移で`body`タグだけを置換する
  - Turbo Framesは部分的に置換する機能
  - Turbo Streamsは複数箇所のHTMLを同時に更新する機能
  - `turbo-rails`のgemを使うとRailsでより便利にTurboを使うことができる
  - Scaffoldで用意される7つのアクション以外でJavaScriptが必要なときにStimulusを使う
  - Turbo Drive→Turbo Frames→Turbo Streams→Stimulusの順で使う
- 3 チュートリアル1 Railsで管理画面を作る
  - Turboを無効にするには`application.js`に`Turbo.session.drive = false`を記述する
  - Rails6ではJavaScriptの管理はWebpackerだったが、Rails7からはバンドラーを使わない`importmap-rails`かバンドラーを使う`jsbundling-rails`のどちらかを使う
  - `jsbundling-rails`ではesbuildを使ってビルドするが、`rails s`ではビルドされないため、`bin/dev`を実行してforemanというプロセス管理ツールを使って、JavaScriptとCSSのビルドを行う
- 4 チュートリアル2 Turboで管理画面をSPA風に作る
  - Turbo Driveを有効にするために`Turbo.session.drive = false`を削除する
  - 以前訪れたページではTurbo Driveのキャッシュが使われる
  - Turbo Framesで部分置換する場合は`turbo_frame_tag`で置換したい場所を囲むと、サーバー側で`turbo_frame_tag`が`<turbo-frame></turbo-frame>`になって解釈される
  - 置換したい部分からTurbo Frameリクエストを送信できない場合は、フォームやリンクに`data-turbo-frame`属性を指定する
  - Turbo Framesのリクエストからレスポンスの流れ
    1. リクエストヘッダーに`Turbo-Frame: id`が付与されたTurboのリクエストが送信される
    2. サーバー側でTurbo Frameリクエストと判断し、レイアウトテンプレートをレンダリングせずにアクションのテンプレートをレンダリングしてレスポンスする
  - Turbo Streamsのリクエストからレスポンスの流れ
    1. 
  - Turboを使うときにバリデーションエラーでHTMLをレスポンスするときは`422 unprocessable_entity`を返す必要がある
  - Turbo Streamsの実装の流れ
    1. コントローラのアクション内の`redirect_to`を削除して暗黙的に`render`が実行されるようにする
    2. `action.turbo_stream.erb`を作成する
    3. `action.turbo_stream.erb`でビューヘルパーを使って複数箇所を置換する
- 5 チュートリアル3 Stimulusで管理画面をもっとSPA風にする
  - 基本的なStimulusのコードは、コントローラ、ターゲット、アクションの3つの要素からなる
- 6 Turbo Drive
  - Turbo Driveで`body`タグだけを置換することで、現在のCSS、JavaScriptをそのまま使える
  - 処理の流れ
    1. リクエストを送信したときにTurbo Driveがデフォルトのリクエスト処理をインターセプトしてfetchに差し替える
    2. `head`タグ内のassetsが同じなら処理を継続し、異なるなら`location.href`を書き換えリダイレクトする
    3. `body`を現在のページのものと差し替える
    4. `head`の一部（title, CSRFトークン）を現在のページのものと差し替える
    5. `history.pushState()`でURLを更新する
  - Turboはキャッシュ機能があり、ブラウザの戻る・進む機能と、プレビューで使う
  - ブラウザのタブのスピナーが使えなくなるので、プログレスバーが代わりに使われる
  - Turbo Driveを使うと、アセットが初回しか読み込まれないので、`stylesheet_link_tag`、`javascript_include_tag`に`"data-turbo-track": "reload"`を指定して、最新のアセットを読み込むためにページを更新できる
  - Turbo Driveは画面遷移時にブラウザの画面遷移を模倣するためにHistory APIを使ってブラウザの履歴を操作している
  - TurbolinksはRails4からデフォルトで導入されたアプリを高速化するためのgem
  - TurbolinksからTurbo Driveへの変更
    - リンクだけじゃなくフォームも扱うようになった
    - `rails-ujs`がデフォルトのgemから外れてTurboが担うようになった
    - Turbolinksのイベント名、クラス名が`Turbo`に変更
  - Turbo Driveでは画面遷移時に`DOMContentLoaded`が発火しない（最初の読み込み時だけ発火する）ので、`turbo:load`を使う
- 7 Turbo Frames
  - Turbo FrameリクエストではURLは変わらないので、`data-turbo-action`属性を指定する
  - Turbo Frameではプログレスバーが用意されない
  - idが一致する`<turbo-frame>`がないとエラーになる
  - Turbo Frameでは二箇所を同時に置換できない
- 8 Turbo Streams(Fetch)
  - Turbo Framesは置換しかできないが、Turbo Stremasでは追加・更新・削除ができる
  - 基本のメソッドは`prepend`、`append`、`before`、`after`、`replace`、`update`、`remove`で、このメソッドに`_all`をつけたものもある
  - Turbo Sreamsのビューのレンダリングはコントローラでも書けるが、ビューに書いたほうがいい
  - Turbo StremasはGET以外のメソッドしか使えない
  - Turbo Framesでは`turbo-frame`で囲うだけでTurbo側が処理してくれるが、Turbo Streamesでは何を操作するか明示的に指定する必要がある
  - JavaScriptの無効に対応するために`turbo-stream`と`html`の2つのフォーマットに対する処理を書いておく
  - Streamesのターゲットは`turbo-frame`でなくていい
- 9 Turbo Streams(WebSocket)
  - WebSocketを使うことで、リクエストがない場合でもサーバーからTurbo Streamsを送れるようになり、リアルタイムなアプリを開発できる（誰か一人が更新するとリクエストに関係なく他の人も更新される）
  - WebSocketによるTurbo Streamesを使うときは内部的にAction Cableを使うことになる
  - `bin/dev`でサーバーを起動するときにRedisサーバーも起動する
  - 多くのアプリではWebSocketは必要ない
- 11 Tips詰め合わせ
  - rails-ujsの機能
    - `form_with`で`local: false`を指定すると非同期リクエストを実行できる → デフォルトでfetchリクエストを行う
    - リンクで`data-method`を指定するとGET以外のHTTPメソッドを指定できる → `data-turbo-method`を使う
    - `data-confirm`で確認ダイアログを出せる → `data-turbo-confirm`を使う
    - リンク・フォームのダブルクリックを防ぐために送信時にボタンが自動的に無効になる
  - 全てのページでHotwireを使う必要はない
  - HotwireはIE11はサポート外で、それ以外のメジャーなブラウザではサポートされている
  - Turboのテストは普通のシステムテストでOK
  - DeviseはTurboを完全にサポートしていないので、Deviseのリンク・フォームで`data: { turbo: false }`を指定して無効化するとよい

### udemy React完全入門ガイド
- 1 はじめに
  - Reactは世界で一番使われている
  - Reactはスマホアプリやデスクトップアプリでも使える
- 3 Reactで頻出のJavaScriptの記法

## わからなかったこと
- 

## エラー
- 

## 次やること
- udemy JavaScriptメカニズム
  - 非同期処理
  - モジュール
- udemy React完全入門ガイド
  - 4
  - 5
  - 6

## 感想
Hotwireの記事めちゃくちゃわかりやすい。でもTurbo Streamsの更新、登録、削除の処理で記述が省略して書けるから流れの把握が難しかった。
Turboの細かいメソッドや実装はおいといて、Turboがどういう機能を提供しているかと、RailsのJavaScriptに関して把握できてきた。

さっさとインプット終わらしたい。