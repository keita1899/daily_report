# 7/26

## 取り組んだこと
- ポートフォリオ 英語日記
  - プロフィール機能
- udemy クリーンコード
  - 6
  - 7

## 学んだこと
- ログイン処理の流れ
  1. フォーム（メールアドレスとパスワード）を送信
  2. メールアドレスでユーザーのデータを取得
  3. 取得したユーザーのパスワードと送信したパスワードがあっているか確認する
  4. あっていればセッションをリセットして`session`メソッドでユーザーのidをセッションに格納する
  5. リダイレクトする
- rails7でTurboを使っている時は、バリデーション失敗時に`status: :unprocessable_entry`をつける、destroyのレスポンスに`status: :see_other`をつける
- rails7ではrails-ujsは非推奨
- esbuildはwebpackより速いらしい
- Hotwireを使うならimport-map、それ以外ならesbuildを使う
- esbuild使うとTurbo使えなくなってる
  - `yarn add @hotwired/turbo-rails`でインストール
  - `app/javascript/application.js`に`import { Turbo } from "@hotwired/turbo-rails";`を追記
  - `yarn build`を実行で使えるようにした
- minitestでは`session`メソッドを使えるけど、rspecでは使えない
- Active Storageの使い方
  1. `rails active_storage:install`を実行する
  2. `rails db:migrate`を実行する
  3. モデルと関連づける
- `form_with`の`local: true`を指定した時と指定しないときの違い
  - 指定したときはブラウザの標準のフォームを使って、JavaScriptやTurboの影響を受けず、ページが完全にリロードされる
  - 指定しない時はTurboを使ってフォームを送信し、Ajaxでリクエストを送信する（デフォルト）

### udemy クリーンコード
- 6章 繰り返し処理
  - 基本的にwhileより制御コードがまとまっているfor文を使う
  - ループを抜ける値が固定ではない（値がランダム）場合はwhile文が向いている
  - for文で使う変数はfor文の直前で定義する
  - 同じループ内で複数のことをしない
  - ループで使う`i`などのカウンタ変数をループ内の処理で変更してはいけない
  - for文の中でfor文を書くような複雑な処理の場合は、カウンタ変数を具体的につける（前提として複数のことはしないようにする）
  - for..ofは値が渡ってくるが、for..inは添字が渡ってくる
  - for..of、for..inはパフォーマンス的にはfor文に劣る
  - forEach、map、filterなどの高階関数を使うことで、無駄な変数の定義を減らしたり、ループの制御と処理を分離できたり、どんな処理を行うか明確にできる
- 7章 条件分岐
  - 境界条件を変数として定義する（例えばwidth / 2ではなくwith_half）
  - 条件式を関数に切り出す
  - 定数を左辺に配置することで、代入と書き間違えてもエラーが起こるようにしたり、何と比較するのかというのを先に書ける
  - 最も一般的なケースを最初に評価する（例えば通常ユーザー→プレミアムユーザー→管理ユーザー）
  - 条件に合わない場合に関数を修了させる、早期 return （ガード節）を使う
  - 早期returnでネストを解消すると、どんな条件をくぐってきたか分かりやすくなる
  - ネストを深くしない
  - できるだけ条件分岐をあちこちに書かずにまとめる
  - switch文ではなく連想配列を使えないか検討する
  - if文よりコールバック、クラスを使えないか検討する
  - コールバックを使うと、渡す関数によって処理が変わる = 分岐と同じ扱いになる
  - 親クラスでエラーが発生するメソッドを実装することで、子クラスでそのメソッドのオーバーライドを必須にする

## わからなかったこと
- バリデーションで表示するエラーメッセージの優先順位
- active storageのバリデーション
- `attach_file`の`locator`の指定
  - とりあえず`user[avatar]`にしたらいけた

## 次やること
- udemy クリーンコード
  - 8
  - 9
- ポートフォリオ 英語日記
  - パスワードリセット
  - メールアドレス変更
  - アカウント削除

## 感想
Turboがだるすぎる。エラーで手こずりすぎて1日1機能ぐらいしか作れてない。まあ認証を自作してるから多少はしょうがない。

クリーンコードは説明を見ながらだと納得できるけど、いざ自分で実装する時には見落としそう。ちょくちょく当たり前すぎることもあるから、逆に不安